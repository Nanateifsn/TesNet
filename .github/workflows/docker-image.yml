    name: Run Kuzco Installer Docker

on:
  workflow_dispatch:
    schedule:
     - cron: '0 */6 * * *' # Setiap 6 jam (UTC)

jobs:
  run-kuzco:
    runs-on: ubuntu-latest

    steps:
      - name: Clone kuzco-installer-docker repo & Run Compose
        run: |
          git clone https://github.com/direkturcrypto/kuzco-installer-docker
          cd kuzco-installer-docker/kuzco-main
          docker compose up -d --build
          docker ps
          curl --location 'http://localhost:14441/v1/chat/completions' \
          --header 'Content-Type: application/json' \
          --data '{
              "model": "llama-3.1-8b-instruct",
              "messages": [{
              "role": "system",
              "content": "You are a helpful assistant."
            },{
              "role": "user",
              "content": "who is your name ?"
            }],
             "top_p": 1,
             "temperature": 0.5,
              "presence_penalty": 0,
              "frequency_penalty": 0,
              "stream": false,
              "stream_options": {
                "include_usage": true
              }
          }'


      - name: Wait for containers (6jam)
        run: 
          cd kuzco-installer-docker/kuzco-main
          docker compose logs --tail 100
          sleep 21600
